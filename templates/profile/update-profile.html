{% extends "base.html" %}
{% block content %}

{% load crispy_forms_tags %}

<style>

    .profile-picture {
        width: 15rem;
        height: 15rem;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        margin: auto;
        margin-bottom: 2rem;
        border: 3px solid var(--bs-secondary-bg);
    }

    .profile-picture img {
        position: absolute;
        object-fit: cover;
        width: 15rem;
        height: 15rem;
        border-radius: 50%;
    }

    #file-input {
        display: none;
    }
    
    .-label {
        display: none;
        position: absolute;
        cursor: pointer;
        height: 15rem;
        width: 15rem;
        border-radius: 50%;
        background-color: none;
        color: transparent;
    }

    .profile-picture:hover {
        .-label {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(0,0,0,.8);
            color: white;
            z-index: 10000;
            margin-bottom: 0;
        }
    }

    span {
        display: inline-flex;
        padding: .2em;
        height: 2em;
    }

</style>

<div class="container py-5 rounded" >
    <div class="col-6 mx-auto">

        <div class="mb-3 justify-content-center text-center">
            <div class="profile-picture">
                <label class="-label" for="file-input">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-camera-fill" viewBox="0 0 16 16">
                        <path d="M10.5 8.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"/>
                        <path d="M2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4zm.5 2a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1m9 2.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0"/>
                    </svg>
                    <span class="ms-2">Change Image</span>
                </label>
                <form
                hx-trigger="change"
                hx-post="/profile/update-picture/"
                hx-encoding="multipart/form-data"
                hx-target="#profile-img"
                hx-swap="outerHTML">
                    <input id="file-input" name="file-input" type="file" />
                </form>
                {% if profile.profile_picture %}
                    <img id="profile-img" src="{{ profile.profile_picture.url }}" alt="Profile Picture">
                {% else %}
                    <img id="profile-img" src="/media/profile_pictures/default/default.png" alt="Profile Picture">
                {% endif %}
            </div>
            <h1>{{ profile.user.username|upper }}</h1>
        </div>

        <form 
        id="update-profile-form" 
        hx-post={% url 'update_profile' %}
        hx-swap="none"
        hx-on::after-swap="alert('Profile Updated Successfully')"
        >
            {% csrf_token %}
            <label class="mb-1" for="email">Email *</label>
            <input type="email" class="form-control mb-3" id="email" name="email" value="{{ user.email }}">
            <label class="mb-1" for="first_name">First Name *</label>
            <input type="text" class="form-control mb-3" id="first_name" name="first_name" value="{{ user.first_name }}">
            <label class="mb-1" for="last_name">Last Name *</label>
            <input type="text" class="form-control mb-3" id="last_name" name="last_name" value="{{ user.last_name }}">
            <label class="mb-1" for="phone">Phone *</label>
            <input type="text" class="form-control mb-3" id="phone" name="phone" value="{{ profile.phone_number }}">
            <label class="mb-1" for="location">Location</label>
            <input type="text" class="form-control mb-3" id="location-input" name="location" value="{{ profile.location }}">
            <label class="mb-1" for="goal">Goal</label>
            <select class="form-select" id="goal" name="goal">
                {% for option in GOAL_CHOICES %}
                <option value="{{option.0}}" {% if profile.goal == option %} selected {% endif %}>{{option.0}}</option>
                {% endfor %}
            </select> 

            <div class="d-flex justify-content-center mt-5">
                <button type="submit" class="btn love">Update Profile</button>
            </div>

        </form>
    </div>
</div>

<script>

    function initialize() {
        new google.maps.places.Autocomplete(searchInput);
    }

    const searchInput = document.getElementById('location-input');
    searchInput.addEventListener('keypress', initialize);

</script>

{% endblock content %}