<style>
    .navbar a {
        color: white!important;
    }
    .profile-badge {
        width:2rem; 
        height:2rem; 
        border-radius:100%; 
    }

    @media (max-width: 576px) {
        #profile-badge-container {
            display: none;
        }
    }
</style>

<nav 
id="navbar" 
class="navbar navbar-expand-lg px-sm-5 position-fixed w-100 py-1" 
style="z-index: 9998; background-color: var(--love);"
data-bs-theme="dark"
>
    <div class="container-fluid">

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon" ></span>
        </button>

        <div class="collapse navbar-collapse justify-content-between" id="navbarSupportedContent">

            <a class="navbar-brand" href="/">NHB</a>
            <ul class="navbar-nav mb-2 mb-lg-0">
                <li class="nav-item me-2">
                    <a class="nav-link {% if request.get_full_path == '/' %}active{% endif %}" aria-current="page" href="/">
                        Home
                    </a>
                </li>
                <li class="nav-item me-2">
                    <a class="nav-link {% if '/explore/' in request.get_full_path %}active{% endif %}" href="/explore/">
                        Explore
                    </a>
                </li>
                <li class="nav-item me-2 dropdown" >
                    <a class="nav-link dropdown-toggle {% if '/agents/' in request.get_full_path %}active{% endif %}" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Agents
                    </a>    
                    <ul id='nav-dropdown' class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">Find an Agent</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="/agents/become-an-agent/">Become an Agent</a></li>
                    </ul>
                </li>
                
            </ul>
            
        <ul class="navbar-nav mb-2 mb-lg-0">
            {% if not user.is_authenticated %}
                <li class="nav-item">
                    <a class="nav-link" href="/account/register/">Login / Signup</a>
                </li>
                {% else %}
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        
                        <div id="profile-badge-container">
                        {% if not user.profile_set.first.profile_picture %}
                            {% include "icons/profile-icon.html" %}
                        {% else %}
                            <img src="{{ user.profile_set.first.profile_picture.url }}" class="profile-badge me-1" alt="profile picture">
                        {% endif %}
                        </div>
                        
                        Profile
                    </a>    
                    <ul id='nav-dropdown' class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url 'profile' username=user.username %}">My Profile</a></li>
                        <li><a class="dropdown-item" href="{% url 'saved_property_list' profile_id=user.profile_set.first.id %}">Saved Properties</a></li>
                        <li><a class="dropdown-item" href="#">Settings</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="/account/logout/">Log Out</a></li>
                    </ul>
                </li>
            {% endif %}
        </ul>

        <!-- <form class="d-flex" role="search">
            <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success" type="submit">Search</button>
        </form> -->
        </div>
    </div>
</nav>

<script data-theme="{{request.user.profile_set.first.theme}}" async>

    function toggleTheme(e) {
        var theme = document.documentElement.getAttribute('data-bs-theme');
        var newTheme = theme === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-bs-theme', newTheme);
        document.cookie = `theme=${newTheme};`;
        htmx.ajax('GET', '/profile/toggle-theme/', {swap:'none'});
    }

    const themeToggle = document.getElementById('theme-toggle');
    themeToggle.addEventListener('change', toggleTheme, false);

</script>