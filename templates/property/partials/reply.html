{% load time_delta %}

<div id="reply-{{reply.id}}" class="card-body ms-4 my-0 pt-2 pb-1" style="border-left: 2px solid var(--bs-secondary-bg);">
    <div class='d-flex align-items-start'>
        <span class="profile-badge">
            <p>{{ reply.profile.user.username.0 }}</p>
        </span>
        <p style="font-size: 1rem; color:var(--bs-secondary-color)">{{ reply.profile.user.username }}</p>
        <p class="card-text"><small class="text-muted">&ensp;&#8226;&ensp;{{ reply.timestamp|time_delta }}</small></p>
    </div>
    <p class="card-text my-1 ms-1">{{ reply.text }}</p>

    <div id="reply-actions" class="d-flex justify-content-end">
        <a class="comment-action">&#8226;&#8226;&#8226;</a>
        <a class="comment-action">
            {% comment %} {% include "icons/thumbs-up.html" %} {% endcomment %}
            Like
        </a>

        <a 
        class="comment-action"
        hx-get="{% url 'new_reply' comment_id=comment.id %}"
        hx-target="#reply-section-{{comment.id}}"
        hx-swap="afterbegin"
        hx-vals='{ "text": "@{{ reply.profile.user.username }} " }'
        >Reply</a>

        {% if request.user.id == reply.profile.user.id %}

        <a 
        class="comment-action"
        hx-get="{% url 'edit_reply' reply_id=reply.id %}"
        hx-target="#reply-{{reply.id}}"
        hx-swap="outerHTML" 
        >Edit</a>

        <a 
        class="comment-action" 
        hx-delete="{% url 'delete_reply' reply_id=reply.id %}"
        hx-target="#reply-{{ reply.id }}"
        hx-swap="delete"
        hx-confirm="Are you sure you want to delete this comment?"
        >Delete</a>

        {% endif %}
    </div>
</div>

<button 
id="show-replies-{{comment.id}}"
class="btn position-absolute p-1" 
style="top:-30px; left:13px; color: var(--bs-secondary-color); display:none;"
onClick="showReplies('{{comment.id}}')"
hx-swap-oob="true"
>
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
    </svg>
    <span 
    id="reply-count-{{comment.id}}" 
    class="ms-1" 
    style="font-size:.8rem;"
    hx-trigger="delete-reply-{{comment.id}} from:body"
    hx-get="{% url 'get_reply_count' comment_id=comment.id %}"
    hx-swap="innerHTML"
    >View {{ comment.reply_set.count }} replies</span>
</button>